openapi: 3.1.0
info:
  title: Harmony Care API
  version: 1.0.0
  description: |
    API for the Harmony Care platform, providing services for care management, user authentication, and administrative tasks.
    - REQ-API-0001: The API must provide a secure and reliable interface for all platform operations.
servers:
  - url: https://api.harmony.care/api/trpc
    description: Production server
paths:

  /auth.me:
    get:
      summary: Get Current User
      description: Retrieves the currently authenticated user's information. API-AUTH-GET-ME
      tags:
        - Auth
      responses:
        '200':
          description: Successful response with user data.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized.
  /auth.logout:
    post:
      summary: Logout User
      description: Logs out the current user by clearing the session cookie. API-AUTH-POST-LOGOUT
      tags:
        - Auth
      responses:
        '200':
          description: Successful logout.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true

  /admin.analytics:
    get:
      summary: Get Admin Analytics
      description: Retrieves platform analytics for the admin dashboard. API-ADMIN-GET-ANALYTICS
      tags:
        - Admin
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Successful response with analytics data.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminAnalytics'
        '401':
          description: Unauthorized.

  /admin.signups:
    get:
      summary: Get All Signups
      description: Retrieves a list of all early access signups. API-ADMIN-GET-SIGNUPS
      tags:
        - Admin
      security:
        - cookieAuth: []
      responses:
        '200':
          description: A list of signups.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Signup'
        '401':
          description: Unauthorized.

  /admin.exportCSV:
    get:
      summary: Export Signups to CSV
      description: Exports all signup data to a CSV file. API-ADMIN-GET-EXPORTCSV
      tags:
        - Admin
      security:
        - cookieAuth: []
      responses:
        '200':
          description: CSV file content.
          content:
            application/json:
              schema:
                type: object
                properties:
                  csv:
                    type: string
                  filename:
                    type: string
        '401':
          description: Unauthorized.

  /signup.create:
    post:
      summary: Create Signup
      description: Creates a new early access signup. API-SIGNUP-POST-CREATE
      tags:
        - Signup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSignupInput'
      responses:
        '200':
          description: Signup created successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
        '400':
          description: Invalid input.

  /referral.validate:
    post:
      summary: Validate Referral Code
      description: Validates a referral code. API-REFERRAL-POST-VALIDATE
      tags:
        - Referral
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                referralCode:
                  type: string
      responses:
        '200':
          description: Referral code is valid.
          content:
            application/json:
              schema:
                type: object
                properties:
                  isValid:
                    type: boolean
        '400':
          description: Invalid referral code.

  /system.health:
    get:
      summary: Health Check
      description: Checks the health of the system. API-SYSTEM-GET-HEALTH
      tags:
        - System
      responses:
        '200':
          description: System is healthy.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        openId:
          type: string
        name:
          type: string
        email:
          type: string
        loginMethod:
          type: string
        role:
          type: string
          enum: [user, admin]
    Signup:
      type: object
      properties:
        id:
          type: integer
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
        phone:
          type: string
        facilityName:
          type: string
        facilityType:
          type: string
        residentCount:
          type: integer
        tier:
          type: string
        interestedFeatures:
          type: array
          items:
            type: string
        additionalNeeds:
          type: string
    AdminAnalytics:
      type: object
      properties:
        totalSignups:
          type: integer
        signupsByTier:
          type: object
        signupsByFacilityType:
          type: object
        totalResidents:
          type: integer
        avgResidentsPerFacility:
          type: integer
        featureCounts:
          type: object
        signupsByDay:
          type: object
        campaignStats:
          type: object
        utmStats:
          type: object
        referralAnalytics:
          type: object
        recentSignups:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              name:
                type: string
              email:
                type: string
              facilityName:
                type: string
              facilityType:
                type: string
              tier:
                type: string
              createdAt:
                type: string
                format: date-time
    CreateSignupInput:
      type: object
      required:
        - firstName
        - lastName
        - email
        - facilityName
        - facilityType
        - residentCount
        - tier
      properties:
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
        phone:
          type: string
        facilityName:
          type: string
        facilityType:
          type: string
        residentCount:
          type: integer
        tier:
          type: string
        interestedFeatures:
          type: array
          items:
            type: string
        additionalNeeds:
          type: string
        utmSource:
          type: string
        utmMedium:
          type: string
        utmCampaign:
          type: string
        utmTerm:
          type: string
        utmContent:
          type: string
        referralCode:
          type: string
n  /referral.create:
    post:
      summary: Create Referral
      description: Creates a new referral relationship. API-REFERRAL-POST-CREATE
      tags:
        - Referral
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateReferralInput'
      responses:
        '200':
          description: Referral created successfully.
        '400':
          description: Invalid input.

  /referral.analytics:
    get:
      summary: Get Referral Analytics
      description: Retrieves analytics for the referral program. API-REFERRAL-GET-ANALYTICS
      tags:
        - Referral
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Successful response with referral analytics.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReferralAnalytics'
        '401':
          description: Unauthorized.

  /referral.milestones:
    get:
      summary: Get Referral Milestones
      description: Retrieves referral milestones for the current user. API-REFERRAL-GET-MILESTONES
      tags:
        - Referral
      security:
        - cookieAuth: []
      responses:
        '200':
          description: A list of milestones.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MilestoneNotification'
        '401':
          description: Unauthorized.
